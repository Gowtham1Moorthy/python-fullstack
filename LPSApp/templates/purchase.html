{% extends "base.html" %}
{% block title %}Purchase Ticket - {% endblock %}
{% block content %}
<head>
    <link rel="stylesheet" type="text/css" href="../../static/css/purchase.css" media="all">
    <link rel="stylesheet" type="text/css" href="../../static/css/partials/footer.css" media="all">
</head>
<body>
    <a href="/browse">Back to Browse</a>
    <h2>Purchase Ticket</h2>
    
    <div>
        <h3>Ticket Information</h3>
        <p>Name: {{ ticket.name }}</p>
        <p>Cost: ${{ ticket.cost }}</p>
    </div>
    
    <div>
        <h3>User Profile Information</h3>
        {% if user_profile.savedcard_set.first %}
            <p>Card Number: {{ user_profile.savedcard_set.first.card_number }}</p>
            <p>Cardholder Name: {{ user_profile.savedcard_set.first.cardholder_name }}</p>
            <p>Expiration Date: {{ user_profile.savedcard_set.first.expiration_date }}</p>
        {% else %}
            <p>No saved cards for this user.</p>
            <p>Please add a card here.</p>
            <form method="post" action="{% url 'purchase' ticket.name %}">
                {% csrf_token %}
                
                <label for="card_number">Card Number:</label>
                <!-- TODO add max length for all inputs -->
                <input type="text" id="card_number" name="card_number" required>
                <br>
                
                <label for="cardholder_name">Cardholder Name:</label>
                <input type="text" id="cardholder_name" name="cardholder_name" required>
                <br>
            
                <label for="expiration_date">Expiration Date:</label>
                <input type="month" id="expiration_date" name="expiration_date" required>
                <br>
            
                <!-- Add more fields if necessary (e.g., CVV) -->
            
                <button type="submit">Save Card</button>
            </form>
        {% endif %}
    </div>
    
    <form method="post" action="{% url 'purchase' ticket.name %}">
        {% csrf_token %}
        
        <div>
            <h3>Payment Details</h3>
            <p>Subtotal: ${{ ticket.cost }}</p>
            <p>Tax: ${{ tax }}</p>
            <p class="total">Total: ${{ ticketCost }}</p>
        </div>
        
        {% if user_profile.savedcard_set.first %}
            <button type="submit">Purchase</button>
        {% else %}
            <p>Please add a card to proceed with the purchase.</p>
        {% endif %}
    </form>
</body>
{% endblock %}